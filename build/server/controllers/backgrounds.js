// Generated by CoffeeScript 1.9.3
var Background, baseController, cozydb, multiparty;

cozydb = require('cozydb');

multiparty = require('multiparty');

Background = require('../models/background');

baseController = new cozydb.SimpleController({
  model: Background,
  reqParamID: 'backgroundid'
});

module.exports = {
  fetch: baseController.fetch,
  all: baseController.listAll,
  "delete": baseController.destroy,
  picture: baseController.sendBinary({
    filename: 'file'
  }),
  thumb: baseController.sendBinary({
    filename: 'thumb'
  }),
  create: function(req, res, next) {
    var form;
    res.on('close', function() {
      return req.abort();
    });
    form = new multiparty.Form();
    return form.parse(req, function(err, fields, files) {
      var file;
      if (err) {
        return next(err);
      } else if ((files != null) && (files.picture != null) && files.picture.length > 0) {
        file = files.picture[0];
        return Background.createNew(file.path, function(err, background) {
          if (err) {
            return next(err);
          }
          return res.send(background);
        });
      } else {
        return next(new Error('Can\'t change background, no file is attached.'));
      }
    });
  }
};
